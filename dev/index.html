<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · SimpleMock.jl</title><link rel="canonical" href="https://christopher-dG.github.io/SimpleMock.jl/index.html"/><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>SimpleMock.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Home</a><ul class="internal"></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Home</a></li></ul><a class="edit-page" href="https://github.com/christopher-dG/SimpleMock.jl/blob/master/docs/src/index.md#L"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="SimpleMock-1" href="#SimpleMock-1">SimpleMock</a></h1><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.SimpleMock" href="#SimpleMock.SimpleMock"><code>SimpleMock.SimpleMock</code></a> — <span class="docstring-category">Module</span>.</div><div><div><p>A basic mocking module, inspired by Python&#39;s <a href="https://docs.python.org/3/library/unittest.mock.html"><code>unittest.mock</code></a> and implemented with <a href="https://github.com/jrevels/Cassette.jl">Cassette</a>.</p><p><strong>Usage</strong></p><p>For usage examples, see <a href="#SimpleMock.mock"><code>mock</code></a>.</p><p><strong>Differences from <code>unittest.mock</code></strong></p><ul><li>SimpleMock only implements mocking of function calls, as opposed to arbitrary monkey-patching.</li><li>Neither <code>getfield</code> nor <code>setfield!</code> is implemented for the default <a href="#SimpleMock.Mock"><code>Mock</code></a> type.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL1-L12">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.mock" href="#SimpleMock.mock"><code>SimpleMock.mock</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">mock(f::Function[, ctx::Symbol], args...)</code></pre><p>Run <code>f</code> with specified functions mocked out.</p><p><strong>Examples</strong></p><p>Mocking a single function:</p><pre><code class="language-julia">mock(print) do print
    @assert print isa Mock
    println(&quot;!&quot;)  # This won&#39;t output anything.
    @assert called_once_with(print, stdout, &quot;!&quot;, &#39;\n&#39;)
end</code></pre><p>Mocking a function with a custom <a href="#SimpleMock.Mock"><code>Mock</code></a>:</p><pre><code class="language-julia">mock((+) =&gt; Mock(; return_value=1)) do plus
    @assert 1 + 1 == 1
    @assert called_once_with(plus, 1, 1)
end</code></pre><p>Mocking methods that match a given signature:</p><pre><code class="language-julia">mock((+, Float64, Float64) =&gt; Mock(; side_effect=(a, b) -&gt; 2a + 2b)) do plus
    @assert 1 + 1 == 2
    @assert 2.0 + 2.0 == 8
    @assert called_once_with(plus, 2.0, 2.0)
end</code></pre><p>Mocking with something other than a <code>Mock</code>:</p><pre><code class="language-julia">mock((+) =&gt; (a, b) -&gt; 2a + 2b) do _plus
    @assert 1 + 2 == 6
end</code></pre><p><strong>Reusing A <code>Context</code></strong></p><p>Under the hood, this function creates a new <a href="https://jrevels.github.io/Cassette.jl/stable/api.html#Cassette.Context">Cassette <code>Context</code></a> on every call by default. This provides a nice clean mocking environment, but it can be slow to create and call new types and methods over and over. If you find yourself repeatedly mocking the same set of functions, you can specify a context name to reuse that context like so:</p><pre><code class="language-julia">julia&gt; ctx = gensym();

# The first time takes a little while.
julia&gt; @time mock(g -&gt; @assert(!called(g)), ctx, get)
  0.156221 seconds (171.93 k allocations: 9.356 MiB)

# But the next time is faster!
julia&gt; @time mock(g -&gt; @assert(!called(g)), ctx, get)
  0.052324 seconds (27.38 k allocations: 1.437 MiB)</code></pre><p>Be careful though! If you call a function that you&#39;ve previously mocked but are not currently mocking, you&#39;ll run into trouble:</p><pre><code class="language-julia">julia&gt; f(s) = strip(uppercase(s));
julia&gt; ctx = gensym();

julia&gt; mock(_g -&gt; f(&quot; hi &quot;), ctx, strip);
julia&gt; mock(_g -&gt; f(&quot; hi &quot;), ctx, uppercase)
ERROR: KeyError: key (strip, Vararg{Any,N} where N) not found</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL179-L252">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.Mock" href="#SimpleMock.Mock"><code>SimpleMock.Mock</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Mock(; return_value=Mock(), side_effect=nothing)</code></pre><p>Create a new mocking object, which behaves similarly to Python&#39;s <a href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock"><code>Mock</code></a>.</p><p><strong>Return Value</strong></p><p>Use the <code>return_value</code> keyword to set the value to be returned upon calling the mock. By default, the return value is a new <code>Mock</code>.</p><p><strong>Side Effects</strong></p><p>Use the <code>side_effect</code> keyword to set a side effect to occur upon calling the mock.</p><ul><li>If the value is an <code>Exception</code>, then the exception is thrown.</li><li>If the value is a function, then it is called with the same arguments and keywords.</li><li>If the value is a <code>Vector</code>, then each call uses the next element.</li><li>Any other value is returned without modification.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL55-L70">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.calls" href="#SimpleMock.calls"><code>SimpleMock.calls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">calls(::Mock) -&gt; Vector{Call}</code></pre><p>Return the call history of the <a href="#SimpleMock.Mock"><code>Mock</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL104-L108">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.ncalls" href="#SimpleMock.ncalls"><code>SimpleMock.ncalls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">ncalls(::Mock) -&gt; Int</code></pre><p>Return the number of times that the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL111-L115">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called" href="#SimpleMock.called"><code>SimpleMock.called</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called(::Mock) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL118-L122">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called_once" href="#SimpleMock.called_once"><code>SimpleMock.called_once</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called_once(::Mock) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called exactly once.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL125-L129">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called_with" href="#SimpleMock.called_with"><code>SimpleMock.called_with</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called_with(::Mock, args...; kwargs...) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called with the given arguments.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL132-L136">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called_once_with" href="#SimpleMock.called_once_with"><code>SimpleMock.called_once_with</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called_once_with(::Mock, args...; kwargs...) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called exactly once with the given arguments.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL139-L143">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.Call" href="#SimpleMock.Call"><code>SimpleMock.Call</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Call(args...; kwargs...)</code></pre><p>Represents a function call.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL41-L45">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.has_call" href="#SimpleMock.has_call"><code>SimpleMock.has_call</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">has_call(::Mock, ::Call) -&gt; Bool</code></pre><p>Similiar to <a href="#SimpleMock.called_with"><code>called_with</code></a>, but using a <a href="#SimpleMock.Call"><code>Call</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL147-L151">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.has_calls" href="#SimpleMock.has_calls"><code>SimpleMock.has_calls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">has_calls(::Mock, ::Calls...) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has a particular ordered sequence of <a href="#SimpleMock.Call"><code>Call</code></a>s.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL154-L158">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.reset!" href="#SimpleMock.reset!"><code>SimpleMock.reset!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">reset!(::Mock)</code></pre><p>Reset a <a href="#SimpleMock.Mock"><code>Mock</code></a>&#39;s call history and internal variables. Side effects and return values are preserved.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/b4158fddbec94c4798c29dc85c7cde226ec34dd2/src/SimpleMock.jl#LL171-L176">source</a></section><ul><li><a href="#SimpleMock.SimpleMock"><code>SimpleMock.SimpleMock</code></a></li><li><a href="#SimpleMock.Call"><code>SimpleMock.Call</code></a></li><li><a href="#SimpleMock.Mock"><code>SimpleMock.Mock</code></a></li><li><a href="#SimpleMock.called"><code>SimpleMock.called</code></a></li><li><a href="#SimpleMock.called_once"><code>SimpleMock.called_once</code></a></li><li><a href="#SimpleMock.called_once_with"><code>SimpleMock.called_once_with</code></a></li><li><a href="#SimpleMock.called_with"><code>SimpleMock.called_with</code></a></li><li><a href="#SimpleMock.calls"><code>SimpleMock.calls</code></a></li><li><a href="#SimpleMock.has_call"><code>SimpleMock.has_call</code></a></li><li><a href="#SimpleMock.has_calls"><code>SimpleMock.has_calls</code></a></li><li><a href="#SimpleMock.mock"><code>SimpleMock.mock</code></a></li><li><a href="#SimpleMock.ncalls"><code>SimpleMock.ncalls</code></a></li><li><a href="#SimpleMock.reset!"><code>SimpleMock.reset!</code></a></li></ul><footer><hr/></footer></article></body></html>
