<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · SimpleMock.jl</title><link rel="canonical" href="https://christopher-dG.github.io/SimpleMock.jl/index.html"/><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>SimpleMock.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Home</a><ul class="internal"><li><a class="toctext" href="#The-Mock-object-1">The <code>Mock</code> object</a></li><li><a class="toctext" href="#The-mock-Function-1">The <code>mock</code> Function</a></li><li><a class="toctext" href="#Filter-Functions-1">Filter Functions</a></li><li><a class="toctext" href="#Index-1">Index</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Home</a></li></ul><a class="edit-page" href="https://github.com/christopher-dG/SimpleMock.jl/blob/master/docs/src/index.md#L"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="SimpleMock-1" href="#SimpleMock-1">SimpleMock</a></h1><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.SimpleMock" href="#SimpleMock.SimpleMock"><code>SimpleMock.SimpleMock</code></a> — <span class="docstring-category">Module</span>.</div><div><div><p>A basic mocking module, inspired by Python&#39;s <a href="https://docs.python.org/3/library/unittest.mock.html"><code>unittest.mock</code></a> and implemented with <a href="https://github.com/jrevels/Cassette.jl">Cassette</a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/SimpleMock.jl#LL1-L3">source</a></section><h2><a class="nav-anchor" id="The-Mock-object-1" href="#The-Mock-object-1">The <code>Mock</code> object</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.Mock" href="#SimpleMock.Mock"><code>SimpleMock.Mock</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Mock(; return_value=Mock(), side_effect=nothing)</code></pre><p>Create a new mocking object that can act as a replacement for a function.</p><p><strong>Return Value</strong></p><p>Use the <code>return_value</code> keyword to set the value to be returned upon calling the mock. By default, the return value is a new <code>Mock</code>.</p><p><strong>Side Effects</strong></p><p>Use the <code>side_effect</code> keyword to set a side effect to occur upon calling the mock.</p><ul><li>If the value is an <code>Exception</code>, then the exception is thrown.</li><li>If the value is callable, then it is called with the same arguments and keywords.</li><li>If the value is a <code>Vector</code>, then each call uses the next element.</li><li>Any other value except <code>nothing</code> is returned without modification.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL17-L34">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.calls" href="#SimpleMock.calls"><code>SimpleMock.calls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">calls(::Mock) -&gt; Vector{Call}</code></pre><p>Return the call history of the <a href="#SimpleMock.Mock"><code>Mock</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL68-L72">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.ncalls" href="#SimpleMock.ncalls"><code>SimpleMock.ncalls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">ncalls(::Mock) -&gt; Int</code></pre><p>Return the number of times that the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL75-L79">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called" href="#SimpleMock.called"><code>SimpleMock.called</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called(::Mock) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL82-L86">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called_once" href="#SimpleMock.called_once"><code>SimpleMock.called_once</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called_once(::Mock) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called exactly once.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL89-L93">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called_with" href="#SimpleMock.called_with"><code>SimpleMock.called_with</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called_with(::Mock, args...; kwargs...) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called with the given arguments.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL96-L100">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.called_once_with" href="#SimpleMock.called_once_with"><code>SimpleMock.called_once_with</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">called_once_with(::Mock, args...; kwargs...) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has been called exactly once with the given arguments.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL103-L107">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.Call" href="#SimpleMock.Call"><code>SimpleMock.Call</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Call(args...; kwargs...)</code></pre><p>Represents a function call.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL3-L7">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.has_call" href="#SimpleMock.has_call"><code>SimpleMock.has_call</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">has_call(::Mock, ::Call) -&gt; Bool</code></pre><p>Similiar to <a href="#SimpleMock.called_with"><code>called_with</code></a>, but using a <a href="#SimpleMock.Call"><code>Call</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL111-L115">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.has_calls" href="#SimpleMock.has_calls"><code>SimpleMock.has_calls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">has_calls(::Mock, ::Calls...) -&gt; Bool</code></pre><p>Return whether or not the <a href="#SimpleMock.Mock"><code>Mock</code></a> has a particular ordered sequence of <a href="#SimpleMock.Call"><code>Call</code></a>s.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL118-L122">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.reset!" href="#SimpleMock.reset!"><code>SimpleMock.reset!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">reset!(::Mock)</code></pre><p>Reset a <a href="#SimpleMock.Mock"><code>Mock</code></a>&#39;s call history. Side effects and return values are preserved.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_type.jl#LL135-L140">source</a></section><h2><a class="nav-anchor" id="The-mock-Function-1" href="#The-mock-Function-1">The <code>mock</code> Function</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.mock" href="#SimpleMock.mock"><code>SimpleMock.mock</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">mock(f::Function, args...; filters::Vector{&lt;:Function}=Function[])</code></pre><p>Run <code>f</code> with specified functions mocked out.</p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>Keyword arguments to mocked functions are not supported. If you call a mocked function with keyword arguments, it will dispatch to the original function. For more details, see <a href="https://github.com/jrevels/Cassette.jl/issues/48">Cassette#48</a>.</p></div></div><p><strong>Examples</strong></p><p>Mocking a single function:</p><pre><code class="language-julia">f(x) = x + 1
mock(+) do plus
    @assert plus isa Mock
    @assert f(0) != 1  # The call to + is mocked.
    @assert called_once_with(p, 0, 1)
end</code></pre><p>Mocking a function with a custom <a href="#SimpleMock.Mock"><code>Mock</code></a>:</p><pre><code class="language-julia">mock((+) =&gt; Mock(; return_value=1)) do plus
    @assert 1 + 1 == 1
    @assert called_once_with(plus, 1, 1)
end</code></pre><p>Mocking methods that match a given signature:</p><pre><code class="language-julia">mock((+, Float64, Float64) =&gt; Mock(; side_effect=(a, b) -&gt; 2a + 2b)) do plus
    @assert 1 + 1 == 2
    @assert 2.0 + 2.0 == 8
    @assert called_once_with(plus, 2.0, 2.0)
end</code></pre><p>Mocking with something other than a <code>Mock</code>:</p><pre><code class="language-julia">mock((+) =&gt; (a, b) -&gt; 2a + 2b) do _plus
    @assert 1 + 2 == 6
end</code></pre><p><strong>Using Filters</strong></p><p>Oftentimes, you mock a function with a very specific idea of where you want that mocking to happen. It can be confusing when a call you didn&#39;t anticipate gets mocked somewhere deep in the call stack, botching everything. To avoid this, you can use filter functions like so:</p><pre><code class="language-julia">f(x, y) = x + y
g(x, y) = f(x, y)
mock((+) =&gt; Mock(; side_effect=(a, b) -&gt; 2a + 2b); filters=[max_depth(2)]) do plus
    @assert f(1, 2) == 6  # The call depth of + here is 2.
    @assert g(3, 4) == 7  # Here, it&#39;s 3.
    @assert called_once_with(plus, 1, 2)
end</code></pre><p>Filter functions take a single argument of type <a href="#SimpleMock.Metadata"><code>Metadata</code></a>. If any filter rejects, then mocking is not performed. See <a href="#Filter-Functions-1">Filter Functions</a> for a list of included filters, as well as building blocks for you to create your own.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/mock_fun.jl#LL15-L84">source</a></section><h2><a class="nav-anchor" id="Filter-Functions-1" href="#Filter-Functions-1">Filter Functions</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.max_depth" href="#SimpleMock.max_depth"><code>SimpleMock.max_depth</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">max_depth(n::Int) -&gt; Function</code></pre><p>Create a filter that rejects when the current call depth is greater than <code>n</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/filters.jl#LL1-L5">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.min_depth" href="#SimpleMock.min_depth"><code>SimpleMock.min_depth</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">min_depth(n::Int) -&gt; Function</code></pre><p>Create a filter that rejects when the current call depth is less than <code>n</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/filters.jl#LL8-L12">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.excluding" href="#SimpleMock.excluding"><code>SimpleMock.excluding</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">excluding(args...) -&gt; Function</code></pre><p>Create a filter that rejects when the calling function or module is in <code>args</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/filters.jl#LL15-L19">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.including" href="#SimpleMock.including"><code>SimpleMock.including</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">including(args...) -&gt; Function</code></pre><p>Create a filter that rejects when the calling function or module is not in <code>args</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/filters.jl#LL22-L26">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.Metadata" href="#SimpleMock.Metadata"><code>SimpleMock.Metadata</code></a> — <span class="docstring-category">Type</span>.</div><div><div><p>Container for mocks and bookkeeping data. Instances of this type are aware of the call depth (<a href="#SimpleMock.current_depth"><code>current_depth</code></a>) and the current function/module (<a href="#SimpleMock.current_function"><code>current_function</code></a>/<a href="#SimpleMock.current_module"><code>current_module</code></a>).</p><p>All filter functions take a single argument of this type.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/metadata.jl#LL1-L6">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.current_depth" href="#SimpleMock.current_depth"><code>SimpleMock.current_depth</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">current_depth(::Metadata) -&gt; Int</code></pre><p>Return the current call depth (the size of the call stack). The depth is always positive, so the first function entered has a depth of 1.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/metadata.jl#LL18-L23">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.current_function" href="#SimpleMock.current_function"><code>SimpleMock.current_function</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">current_function(::Metadata) -&gt; Any</code></pre><p>Return the current function (or other callable thing). In this case, &quot;current&quot; refers, somewhat counterintuitively, not to the function about to be called, but to the function that is about to call it.</p><p>To illustrate:</p><pre><code class="language-julia">f(x) = x
g(x) = f(x)
x = g(1)</code></pre><p>In this case, when the call to <code>f</code> is reached, the function that is calling <code>f</code> is <code>g</code>. Therefore, the &quot;current&quot; function is <code>g</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/metadata.jl#LL26-L42">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SimpleMock.current_module" href="#SimpleMock.current_module"><code>SimpleMock.current_module</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">current_module(m::Metadata) -&gt; Module</code></pre><p>Return the current module, where &quot;current&quot; has the same definition as in <a href="#SimpleMock.current_function"><code>current_function</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/christopher-dG/SimpleMock.jl/blob/60de62a5df1aa4f9808b10d540d8122c783d0a35/src/metadata.jl#LL45-L49">source</a></section><h2><a class="nav-anchor" id="Index-1" href="#Index-1">Index</a></h2><ul><li><a href="#SimpleMock.SimpleMock"><code>SimpleMock.SimpleMock</code></a></li><li><a href="#SimpleMock.Call"><code>SimpleMock.Call</code></a></li><li><a href="#SimpleMock.Metadata"><code>SimpleMock.Metadata</code></a></li><li><a href="#SimpleMock.Mock"><code>SimpleMock.Mock</code></a></li><li><a href="#SimpleMock.called"><code>SimpleMock.called</code></a></li><li><a href="#SimpleMock.called_once"><code>SimpleMock.called_once</code></a></li><li><a href="#SimpleMock.called_once_with"><code>SimpleMock.called_once_with</code></a></li><li><a href="#SimpleMock.called_with"><code>SimpleMock.called_with</code></a></li><li><a href="#SimpleMock.calls"><code>SimpleMock.calls</code></a></li><li><a href="#SimpleMock.current_depth"><code>SimpleMock.current_depth</code></a></li><li><a href="#SimpleMock.current_function"><code>SimpleMock.current_function</code></a></li><li><a href="#SimpleMock.current_module"><code>SimpleMock.current_module</code></a></li><li><a href="#SimpleMock.excluding"><code>SimpleMock.excluding</code></a></li><li><a href="#SimpleMock.has_call"><code>SimpleMock.has_call</code></a></li><li><a href="#SimpleMock.has_calls"><code>SimpleMock.has_calls</code></a></li><li><a href="#SimpleMock.including"><code>SimpleMock.including</code></a></li><li><a href="#SimpleMock.max_depth"><code>SimpleMock.max_depth</code></a></li><li><a href="#SimpleMock.min_depth"><code>SimpleMock.min_depth</code></a></li><li><a href="#SimpleMock.mock"><code>SimpleMock.mock</code></a></li><li><a href="#SimpleMock.ncalls"><code>SimpleMock.ncalls</code></a></li><li><a href="#SimpleMock.reset!"><code>SimpleMock.reset!</code></a></li></ul><footer><hr/></footer></article></body></html>
